


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>qutip.qip.pulse &mdash; QuTiP 4.7 Documentation</title>
  

  
  <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/site.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
        <script src="../../../static/jquery.js"></script>
        <script src="../../../static/underscore.js"></script>
        <script src="../../../static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
              <div class="version">
                4.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/guide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/build/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/development.html">Development Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biblio.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright and Licensing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qutip.qip.pulse</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qutip.qip.pulse</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>

<span class="kn">from</span> <span class="nn">qutip.qobjevo</span> <span class="kn">import</span> <span class="n">QobjEvo</span>
<span class="kn">from</span> <span class="nn">qutip.qobj</span> <span class="kn">import</span> <span class="n">Qobj</span>
<span class="kn">from</span> <span class="nn">qutip.qip.operations</span> <span class="kn">import</span> <span class="n">expand_operator</span>
<span class="kn">from</span> <span class="nn">qutip.operators</span> <span class="kn">import</span> <span class="n">identity</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Pulse&quot;</span><span class="p">,</span> <span class="s2">&quot;Drift&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_EvoElement</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class object saving the information of one evolution element.</span>
<span class="sd">    Each dynamic element is characterized by four variables:</span>
<span class="sd">    `qobj`, `targets`, `tlist` and `coeff`.</span>

<span class="sd">    For documentation and use instruction of the attributes, please</span>
<span class="sd">    refer to :class:`.Pulse`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qobj</span> <span class="o">=</span> <span class="n">qobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tlist</span> <span class="o">=</span> <span class="n">tlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">coeff</span>

    <span class="k">def</span> <span class="nf">get_qobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the `Qobj` representation of the element. If `qobj` is None,</span>
<span class="sd">        a zero :class:`qutip.Qobj` with the corresponding dimension is</span>
<span class="sd">        returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qobj: :class:`qutip.Qobj`</span>
<span class="sd">            The operator of this element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">dims</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qobj</span> <span class="o">=</span> <span class="n">identity</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qobj</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span>
        <span class="k">return</span> <span class="n">expand_operator</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">),</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_qobjevo_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Please refer to `_Evoelement.get_qobjevo` for documentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_qobj</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tlist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qu</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">qu</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">qu</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">([</span><span class="n">mat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">))],</span>
                                 <span class="n">tlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qu</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">(</span><span class="n">mat</span> <span class="o">*</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spline_kind</span> <span class="o">==</span> <span class="s2">&quot;step_func&quot;</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_step_func_coeff&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">spline_kind</span> <span class="o">==</span> <span class="s2">&quot;cubic&quot;</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_step_func_coeff&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The spline will follow other pulses or</span>
                <span class="c1"># use the default value of QobjEvo</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">qu</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">([</span><span class="n">mat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span><span class="p">],</span> <span class="n">tlist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qu</span>

    <span class="k">def</span> <span class="nf">get_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the `QobjEvo` representation of the evolution element.</span>
<span class="sd">        If both `tlist` and `coeff` are None, treated as zero matrix.</span>
<span class="sd">        If ``coeff=True`` and ``tlist=None``,</span>
<span class="sd">        treated as time-independent operator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spline_kind: str</span>
<span class="sd">            Type of the coefficient interpolation.</span>
<span class="sd">            &quot;step_func&quot; or &quot;cubic&quot;</span>

<span class="sd">            -&quot;step_func&quot;:</span>
<span class="sd">            The coefficient will be treated as a step function.</span>
<span class="sd">            E.g. ``tlist=[0,1,2]`` and ``coeff=[3,2]``, means that the</span>
<span class="sd">            coefficient is 3 in t=[0,1) and 2 in t=[2,3). It requires</span>
<span class="sd">            ``len(coeff)=len(tlist)-1`` or ``len(coeff)=len(tlist)``, but</span>
<span class="sd">            in the second case the last element of `coeff` has no effect.</span>

<span class="sd">            -&quot;cubic&quot;: Use cubic interpolation for the coefficient. It requires</span>
<span class="sd">            ``len(coeff)=len(tlist)``</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qobjevo: :class:`qutip.QobjEvo`</span>
<span class="sd">            The `QobjEvo` representation of the evolution element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_qobjevo_helper</span><span class="p">(</span><span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;The Evolution element went wrong was</span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">({</span><span class="s2">&quot;qobj&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qobj</span><span class="p">,</span>
                    <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                    <span class="s2">&quot;tlist&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tlist</span><span class="p">,</span>
                    <span class="s2">&quot;coeff&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff</span>
                    <span class="p">})</span>


<div class="viewcode-block" id="Pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse">[docs]</a><span class="k">class</span> <span class="nc">Pulse</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a control pulse and the pulse dependent noise.</span>
<span class="sd">    The pulse is characterized by the ideal control pulse, the coherent</span>
<span class="sd">    noise and the lindblad noise. The later two are lists of</span>
<span class="sd">    noisy evolution dynamics.</span>
<span class="sd">    Each dynamic element is characterized by four variables:</span>
<span class="sd">    `qobj`, `targets`, `tlist` and `coeff`.</span>

<span class="sd">    See examples for different construction behavior.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    qobj: :class:&#39;qutip.Qobj&#39;</span>
<span class="sd">        The Hamiltonian of the ideal pulse.</span>
<span class="sd">    targets: list</span>
<span class="sd">        target qubits of the ideal pulse</span>
<span class="sd">        (or subquantum system of other dimensions).</span>
<span class="sd">    tlist: array-like, optional</span>
<span class="sd">        `tlist` of the ideal pulse.</span>
<span class="sd">        A list of time at which the time-dependent coefficients are applied.</span>
<span class="sd">        `tlist` does not have to be equidistant, but must have the same length</span>
<span class="sd">        or one element shorter compared to `coeff`. See documentation for</span>
<span class="sd">        the parameter `spline_kind`.</span>
<span class="sd">    coeff: array-like or bool, optional</span>
<span class="sd">        Time-dependent coefficients of the ideal control pulse.</span>
<span class="sd">        If an array, the length</span>
<span class="sd">        must be the same or one element longer compared to `tlist`.</span>
<span class="sd">        See documentation for the parameter `spline_kind`.</span>
<span class="sd">        If a bool, the coefficient is a constant 1 or 0.</span>
<span class="sd">    spline_kind: str, optional</span>
<span class="sd">        Type of the coefficient interpolation:</span>
<span class="sd">        &quot;step_func&quot; or &quot;cubic&quot;.</span>

<span class="sd">        -&quot;step_func&quot;:</span>
<span class="sd">        The coefficient will be treated as a step function.</span>
<span class="sd">        E.g. ``tlist=[0,1,2]`` and ``coeff=[3,2]``, means that the coefficient</span>
<span class="sd">        is 3 in t=[0,1) and 2 in t=[2,3). It requires</span>
<span class="sd">        ``len(coeff)=len(tlist)-1`` or ``len(coeff)=len(tlist)``, but</span>
<span class="sd">        in the second case the last element of `coeff` has no effect.</span>

<span class="sd">        -&quot;cubic&quot;:</span>
<span class="sd">        Use cubic interpolation for the coefficient. It requires</span>
<span class="sd">        ``len(coeff)=len(tlist)``</span>
<span class="sd">    label: str</span>
<span class="sd">        The label (name) of the pulse.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ideal_pulse: :class:`._EvoElement`</span>
<span class="sd">        The ideal dynamic of the control pulse.</span>
<span class="sd">    coherent_noise: list of :class:`._EvoElement`</span>
<span class="sd">        The coherent noise caused by the control pulse. Each dynamic element is</span>
<span class="sd">        still characterized by a time-dependent Hamiltonian.</span>
<span class="sd">    lindblad_noise: list of :class:`._EvoElement`</span>
<span class="sd">        The dissipative noise of the control pulse. Each dynamic element</span>
<span class="sd">        will be treated as a (time-dependent) lindblad operator in the</span>
<span class="sd">        master equation.</span>
<span class="sd">    spline_kind: str</span>
<span class="sd">        See parameter `spline_kind`.</span>
<span class="sd">    label: str</span>
<span class="sd">        See parameter `label`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Create a pulse that is turned off</span>

<span class="sd">    &gt;&gt;&gt; Pulse(sigmaz(), 0) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; Pulse(sigmaz(), 0, None, None) # doctest: +SKIP</span>

<span class="sd">    Create a time dependent pulse</span>

<span class="sd">    &gt;&gt;&gt; tlist = np.array([0., 1., 2., 4.]) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; coeff = np.array([0.5, 1.2, 0.8]) # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; spline_kind = &quot;step_func&quot; # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; Pulse(sigmaz(), 0, tlist=tlist, coeff=coeff, spline_kind=&quot;step_func&quot;) # doctest: +SKIP</span>

<span class="sd">    Create a time independent pulse</span>

<span class="sd">    &gt;&gt;&gt; Pulse(sigmaz(), 0, coeff=True) # doctest: +SKIP</span>

<span class="sd">    Create a constant pulse with time range</span>

<span class="sd">    &gt;&gt;&gt; Pulse(sigmaz(), 0, tlist=tlist, coeff=True) # doctest: +SKIP</span>

<span class="sd">    Create an dummy Pulse (H=0)</span>

<span class="sd">    &gt;&gt;&gt; Pulse(None, None) # doctest: +SKIP</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">spline_kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_kind</span> <span class="o">=</span> <span class="n">spline_kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span> <span class="o">=</span> <span class="n">_EvoElement</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">coeff</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">qobj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See parameter `qobj`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">qobj</span>

    <span class="nd">@qobj</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">qobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">qobj</span> <span class="o">=</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See parameter `targets`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">targets</span>

    <span class="nd">@targets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See parameter `tlist`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">tlist</span>

    <span class="nd">@tlist</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">tlist</span> <span class="o">=</span> <span class="n">x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See parameter `coeff`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">coeff</span>

    <span class="nd">@coeff</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">x</span>

<div class="viewcode-block" id="Pulse.add_coherent_noise"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.add_coherent_noise">[docs]</a>    <span class="k">def</span> <span class="nf">add_coherent_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new (time-dependent) Hamiltonian to the coherent noise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qobj: :class:&#39;qutip.Qobj&#39;</span>
<span class="sd">            The Hamiltonian of the pulse.</span>
<span class="sd">        targets: list</span>
<span class="sd">            target qubits of the pulse</span>
<span class="sd">            (or subquantum system of other dimensions).</span>
<span class="sd">        tlist: array-like, optional</span>
<span class="sd">            A list of time at which the time-dependent coefficients are</span>
<span class="sd">            applied.</span>
<span class="sd">            `tlist` does not have to be equidistant, but must have the same</span>
<span class="sd">            length</span>
<span class="sd">            or one element shorter compared to `coeff`. See documentation for</span>
<span class="sd">            the parameter `spline_kind` of :class:`.Pulse`.</span>
<span class="sd">        coeff: array-like or bool, optional</span>
<span class="sd">            Time-dependent coefficients of the pulse noise.</span>
<span class="sd">            If an array, the length</span>
<span class="sd">            must be the same or one element longer compared to `tlist`.</span>
<span class="sd">            See documentation for</span>
<span class="sd">            the parameter `spline_kind` of :class:`.Pulse`.</span>
<span class="sd">            If a bool, the coefficient is a constant 1 or 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EvoElement</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">coeff</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">add_control_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_coherent_noise</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="n">tlist</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="n">coeff</span><span class="p">)</span>

<div class="viewcode-block" id="Pulse.add_lindblad_noise"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.add_lindblad_noise">[docs]</a>    <span class="k">def</span> <span class="nf">add_lindblad_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new (time-dependent) lindblad noise to the coherent noise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qobj: :class:&#39;qutip.Qobj&#39;</span>
<span class="sd">            The collapse operator of the lindblad noise.</span>
<span class="sd">        targets: list</span>
<span class="sd">            target qubits of the collapse operator</span>
<span class="sd">            (or subquantum system of other dimensions).</span>
<span class="sd">        tlist: array-like, optional</span>
<span class="sd">            A list of time at which the time-dependent coefficients are</span>
<span class="sd">            applied.</span>
<span class="sd">            `tlist` does not have to be equidistant, but must have the same</span>
<span class="sd">            length</span>
<span class="sd">            or one element shorter compared to `coeff`.</span>
<span class="sd">            See documentation for</span>
<span class="sd">            the parameter `spline_kind` of :class:`.Pulse`.</span>
<span class="sd">        coeff: array-like or bool, optional</span>
<span class="sd">            Time-dependent coefficients of the pulse noise.</span>
<span class="sd">            If an array, the length</span>
<span class="sd">            must be the same or one element longer compared to `tlist`.</span>
<span class="sd">            See documentation for</span>
<span class="sd">            the parameter `spline_kind` of :class:`.Pulse`.</span>
<span class="sd">            If a bool, the coefficient is a constant 1 or 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EvoElement</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">coeff</span><span class="p">))</span></div>

<div class="viewcode-block" id="Pulse.get_ideal_qobj"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.get_ideal_qobj">[docs]</a>    <span class="k">def</span> <span class="nf">get_ideal_qobj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Hamiltonian of the ideal pulse.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        qobj: :class:`qutip.Qobj`</span>
<span class="sd">            The Hamiltonian of the ideal pulse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">get_qobj</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pulse.get_ideal_qobjevo"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.get_ideal_qobjevo">[docs]</a>    <span class="k">def</span> <span class="nf">get_ideal_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a `QobjEvo` representation of the ideal evolution.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ideal_evo: :class:`qutip.QobjEvo`</span>
<span class="sd">            A `QobjEvo` representing the ideal evolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">get_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pulse.get_noisy_qobjevo"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.get_noisy_qobjevo">[docs]</a>    <span class="k">def</span> <span class="nf">get_noisy_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the :obj:`.QobjEvo` representation of the noisy evolution. The</span>
<span class="sd">        result can be used directly as input for the qutip solvers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        noisy_evo: :class:`qutip.QobjEvo`</span>
<span class="sd">            A ``QobjEvo`` representing the ideal evolution and coherent noise.</span>
<span class="sd">        c_ops: list of :class:`qutip.QobjEvo`</span>
<span class="sd">            A list of (time-dependent) lindbald operators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ideal_qu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ideal_qobjevo</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">noise_qu_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">noise</span><span class="o">.</span><span class="n">get_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">noise</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="p">]</span>
        <span class="n">qu</span> <span class="o">=</span> <span class="n">_merge_qobjevo</span><span class="p">([</span><span class="n">ideal_qu</span><span class="p">]</span> <span class="o">+</span> <span class="n">noise_qu_list</span><span class="p">)</span>
        <span class="n">c_ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">noise</span><span class="o">.</span><span class="n">get_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_kind</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">noise</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="p">]</span>
        <span class="n">full_tlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_tlist</span><span class="p">()</span>
        <span class="n">qu</span> <span class="o">=</span> <span class="n">_merge_qobjevo</span><span class="p">([</span><span class="n">qu</span><span class="p">],</span> <span class="n">full_tlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c_op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c_ops</span><span class="p">):</span>
            <span class="n">c_ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_merge_qobjevo</span><span class="p">([</span><span class="n">c_op</span><span class="p">],</span> <span class="n">full_tlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">qu</span><span class="p">,</span> <span class="n">c_ops</span></div>

<div class="viewcode-block" id="Pulse.get_full_tlist"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.get_full_tlist">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_tlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the full tlist of the pulses and noise.  It means that if</span>
<span class="sd">        different ``tlist`` are present, they will be merged to one with all</span>
<span class="sd">        time points stored in a sorted array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        full_tlist: array-like 1d</span>
<span class="sd">            The full time sequence for the noisy evolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO add test</span>
        <span class="n">all_tlists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_tlists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="p">:</span>
            <span class="n">all_tlists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c_op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="p">:</span>
            <span class="n">all_tlists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_op</span><span class="o">.</span><span class="n">tlist</span><span class="p">)</span>
        <span class="n">all_tlists</span> <span class="o">=</span> <span class="p">[</span><span class="n">tlist</span> <span class="k">for</span> <span class="n">tlist</span> <span class="ow">in</span> <span class="n">all_tlists</span> <span class="k">if</span> <span class="n">tlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_tlists</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">full_tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">all_tlists</span><span class="p">)))</span>
        <span class="n">full_tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="n">full_tlist</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">full_tlist</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">full_tlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">full_tlist</span></div>

<div class="viewcode-block" id="Pulse.print_info"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.qip.pulse.Pulse.print_info">[docs]</a>    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the information of the pulse, including the ideal dynamics,</span>
<span class="sd">        the coherent noise and the lindblad noise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------&quot;</span>
              <span class="s2">&quot;-----------------------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pulse label:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The pulse contains: </span><span class="si">{}</span><span class="s2"> coherent noise elements and </span><span class="si">{}</span><span class="s2"> &quot;</span>
              <span class="s2">&quot;Lindblad noise elements.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ideal pulse:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ideal_pulse</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coherent noise:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_noise</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lindblad noise:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lindblad_noise</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------&quot;</span>
              <span class="s2">&quot;-----------------------------------&quot;</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">Drift</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The time independent drift Hamiltonian. Usually its the intrinsic</span>
<span class="sd">    evolution of the quantum system that can not be tuned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    qobj: :class:`qutip.Qobj` or list of :class:`qutip.Qobj`, optional</span>
<span class="sd">        The drift Hamiltonians.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    qobj: list of :class:`qutip.Qobj`</span>
<span class="sd">        A list of the the drift Hamiltonians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">qobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span> <span class="o">=</span> <span class="n">qobj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span> <span class="o">=</span> <span class="p">[</span><span class="n">qobj</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Hamiltonian to the drift.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qobj: :class:&#39;qutip.Qobj&#39;</span>
<span class="sd">            The collapse operator of the lindblad noise.</span>
<span class="sd">        targets: list</span>
<span class="sd">            target qubits of the collapse operator</span>
<span class="sd">            (or subquantum system of other dimensions).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EvoElement</span><span class="p">(</span><span class="n">qobj</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_ideal_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the QobjEvo representation of the drift Hamiltonian.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dims: int or list</span>
<span class="sd">            Dimension of the system.</span>
<span class="sd">            If int, we assume it is the number of qubits in the system.</span>
<span class="sd">            If list, it is the dimension of the component systems.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ideal_evo: :class:`qutip.QobjEvo`</span>
<span class="sd">            A `QobjEvo` representing the drift evolution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span> <span class="o">=</span> <span class="p">[</span><span class="n">_EvoElement</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="n">qu_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">QobjEvo</span><span class="p">(</span><span class="n">evo</span><span class="o">.</span><span class="n">get_qobj</span><span class="p">(</span><span class="n">dims</span><span class="p">))</span> <span class="k">for</span> <span class="n">evo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_hamiltonians</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_merge_qobjevo</span><span class="p">(</span><span class="n">qu_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_noisy_qobjevo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Same as the `get_ideal_qobjevo` method. There is no additional noise</span>
<span class="sd">        for the drift evolution.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        noisy_evo: :class:`qutip.QobjEvo`</span>
<span class="sd">            A `QobjEvo` representing the ideal evolution and coherent noise.</span>
<span class="sd">        c_ops: list of :class:`qutip.QobjEvo`</span>
<span class="sd">            Always an empty list for Drift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ideal_qobjevo</span><span class="p">(</span><span class="n">dims</span><span class="p">),</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_find_common_tlist</span><span class="p">(</span><span class="n">qobjevo_list</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the common `tlist` of a list of :class:`qutip.QobjEvo`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_tlists</span> <span class="o">=</span> <span class="p">[</span><span class="n">qu</span><span class="o">.</span><span class="n">tlist</span> <span class="k">for</span> <span class="n">qu</span> <span class="ow">in</span> <span class="n">qobjevo_list</span>
                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qu</span><span class="p">,</span> <span class="n">QobjEvo</span><span class="p">)</span> <span class="ow">and</span> <span class="n">qu</span><span class="o">.</span><span class="n">tlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_tlists</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">full_tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">all_tlists</span><span class="p">)))</span>
    <span class="n">full_tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="n">full_tlist</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">full_tlist</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">full_tlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">full_tlist</span>

<span class="c1">########################################################################</span>
<span class="c1"># These functions are moved here from qutip.qip.device.processor.py</span>
<span class="c1">########################################################################</span>


<span class="k">def</span> <span class="nf">_merge_qobjevo</span><span class="p">(</span><span class="n">qobjevo_list</span><span class="p">,</span> <span class="n">full_tlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine a list of `:class:qutip.QobjEvo` into one,</span>
<span class="sd">    different tlist will be merged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO This method can be eventually integrated into QobjEvo, for</span>
    <span class="c1"># which a more thorough test is required</span>

    <span class="c1"># no qobjevo</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">qobjevo_list</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;qobjevo_list is empty.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">full_tlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">full_tlist</span> <span class="o">=</span> <span class="n">_find_common_tlist</span><span class="p">(</span><span class="n">qobjevo_list</span><span class="p">)</span>
    <span class="n">spline_types_num</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">qu</span> <span class="ow">in</span> <span class="n">qobjevo_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qu</span><span class="p">,</span> <span class="n">QobjEvo</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">spline_types_num</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">qu</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s2">&quot;_step_func_coeff&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">qu</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spline_types_num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot merge Qobjevo with different spline kinds.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qobjevo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qobjevo_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qobjevo</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">):</span>
            <span class="n">qobjevo_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">QobjEvo</span><span class="p">(</span><span class="n">qobjevo</span><span class="p">)</span>
            <span class="n">qobjevo</span> <span class="o">=</span> <span class="n">qobjevo_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ele</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qobjevo</span><span class="o">.</span><span class="n">ops</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">coeff</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">new_coeff</span> <span class="o">=</span> <span class="n">_fill_coeff</span><span class="p">(</span>
                    <span class="n">ele</span><span class="o">.</span><span class="n">coeff</span><span class="p">,</span> <span class="n">qobjevo</span><span class="o">.</span><span class="n">tlist</span><span class="p">,</span> <span class="n">full_tlist</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                <span class="n">qobjevo_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">new_coeff</span>
        <span class="n">qobjevo_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tlist</span> <span class="o">=</span> <span class="n">full_tlist</span>

    <span class="n">qobjevo</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">qobjevo_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qobjevo</span>


<span class="k">def</span> <span class="nf">_fill_coeff</span><span class="p">(</span><span class="n">old_coeffs</span><span class="p">,</span> <span class="n">old_tlist</span><span class="p">,</span> <span class="n">full_tlist</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.0e-10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a step function coefficients compatible with a longer `tlist` by</span>
<span class="sd">    filling the empty slot with the nearest left value.</span>

<span class="sd">    The returned `coeff` always have the same size as the `tlist`.</span>
<span class="sd">    If `step_func`, the last element is 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s2">&quot;_step_func_coeff&quot;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;_step_func_coeff&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_coeffs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_tlist</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">old_coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">old_coeffs</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">new_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_tlist</span><span class="p">)</span>
        <span class="n">old_ind</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index for old coeffs and tlist</span>
        <span class="n">new_coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">new_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new_n</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">full_tlist</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">old_tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="n">new_coeff</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">old_tlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="n">new_coeff</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">continue</span>
            <span class="c1"># tol is required because of the floating-point error</span>
            <span class="k">if</span> <span class="n">old_tlist</span><span class="p">[</span><span class="n">old_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">tol</span><span class="p">:</span>
                <span class="n">old_ind</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">new_coeff</span><span class="p">[</span><span class="n">new_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_coeffs</span><span class="p">[</span><span class="n">old_ind</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">old_tlist</span><span class="p">,</span> <span class="n">old_coeffs</span><span class="p">)</span>
        <span class="n">new_coeff</span> <span class="o">=</span> <span class="n">sp</span><span class="p">(</span><span class="n">full_tlist</span><span class="p">)</span>
        <span class="n">new_coeff</span> <span class="o">*=</span> <span class="p">(</span><span class="n">full_tlist</span> <span class="o">&lt;=</span> <span class="n">old_tlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">new_coeff</span> <span class="o">*=</span> <span class="p">(</span><span class="n">full_tlist</span> <span class="o">&gt;=</span> <span class="n">old_tlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">new_coeff</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; <a href="../../../copyright.html">Copyright</a> 2011 to 2021 inclusive, QuTiP developers and contributors.
      <span class="lastupdated">
        Last updated on Apr 13, 2022.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>