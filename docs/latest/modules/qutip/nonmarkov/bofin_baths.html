


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>qutip.nonmarkov.bofin_baths &mdash; QuTiP 4.7 Documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/site.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
              <div class="version">
                4.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/guide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/build/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/development.html">Development Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biblio.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright and Licensing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qutip.nonmarkov.bofin_baths</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qutip.nonmarkov.bofin_baths</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides utilities for describing baths when using the</span>
<span class="sd">HEOM (hierarchy equations of motion) to model system-bath interactions.</span>

<span class="sd">See the ``qutip.nonmarkov.bofin_solvers`` module for the associated solver.</span>

<span class="sd">The implementation is derived from the BoFiN library (see</span>
<span class="sd">https://github.com/tehruhn/bofin) which was itself derived from an earlier</span>
<span class="sd">implementation in QuTiP itself.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">enum</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">eigvalsh</span>

<span class="kn">from</span> <span class="nn">qutip.qobj</span> <span class="kn">import</span> <span class="n">Qobj</span>
<span class="kn">from</span> <span class="nn">qutip.superoperator</span> <span class="kn">import</span> <span class="n">spre</span><span class="p">,</span> <span class="n">spost</span>


<div class="viewcode-block" id="BathExponent"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.BathExponent">[docs]</a><span class="k">class</span> <span class="nc">BathExponent</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a single exponent (naively, an excitation mode) within the</span>
<span class="sd">    decomposition of the correlation functions of a bath.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    type : {&quot;R&quot;, &quot;I&quot;, &quot;RI&quot;, &quot;+&quot;, &quot;-&quot;} or BathExponent.ExponentType</span>
<span class="sd">        The type of bath exponent.</span>

<span class="sd">        &quot;R&quot; and &quot;I&quot; are bosonic bath exponents that appear in the real and</span>
<span class="sd">        imaginary parts of the correlation expansion.</span>

<span class="sd">        &quot;RI&quot; is combined bosonic bath exponent that appears in both the real</span>
<span class="sd">        and imaginary parts of the correlation expansion. The combined exponent</span>
<span class="sd">        has a single ``vk``. The ``ck`` is the coefficient in the real</span>
<span class="sd">        expansion and ``ck2`` is the coefficient in the imaginary expansion.</span>

<span class="sd">        &quot;+&quot; and &quot;-&quot; are fermionic bath exponents. These fermionic bath</span>
<span class="sd">        exponents must specify ``sigma_bar_k_offset`` which specifies</span>
<span class="sd">        the amount to add to ``k`` (the exponent index within the bath of this</span>
<span class="sd">        exponent) to determine the ``k`` of the corresponding exponent with</span>
<span class="sd">        the opposite sign (i.e. &quot;-&quot; or &quot;+&quot;).</span>

<span class="sd">    dim : int or None</span>
<span class="sd">        The dimension (i.e. maximum number of excitations for this exponent).</span>
<span class="sd">        Usually ``2`` for fermionic exponents or ``None`` (i.e. unlimited) for</span>
<span class="sd">        bosonic exponents.</span>

<span class="sd">    Q : Qobj</span>
<span class="sd">        The coupling operator for this excitation mode.</span>

<span class="sd">    vk : complex</span>
<span class="sd">        The frequency of the exponent of the excitation term.</span>

<span class="sd">    ck : complex</span>
<span class="sd">        The coefficient of the excitation term.</span>

<span class="sd">    ck2 : optional, complex</span>
<span class="sd">        For exponents of type &quot;RI&quot; this is the coefficient of the term in the</span>
<span class="sd">        imaginary expansion (and ``ck`` is the coefficient in the real</span>
<span class="sd">        expansion).</span>

<span class="sd">    sigma_bar_k_offset : optional, int</span>
<span class="sd">        For exponents of type &quot;+&quot; this gives the offset (within the list of</span>
<span class="sd">        exponents within the bath) of the corresponding &quot;-&quot; bath exponent.</span>
<span class="sd">        For exponents of type &quot;-&quot; it gives the offset of the corresponding</span>
<span class="sd">        &quot;+&quot; exponent.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the exponent (often the name of the bath). It</span>
<span class="sd">        defaults to None.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    All of the parameters are available as attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s2">&quot;ExponentType&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_check_ck2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">ck2</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;RI&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ck2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;RI bath exponents require ck2&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ck2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Second co-efficient (ck2) should only be specified for RI&quot;</span>
                    <span class="s2">&quot; bath exponents&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_sigma_bar_k_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;+ and - bath exponents require sigma_bar_k_offset&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Offset of sigma bar (sigma_bar_k_offset) should only be&quot;</span>
                    <span class="s2">&quot; specified for + and - bath exponents&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span><span class="p">,</span> <span class="n">ck2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma_bar_k_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">):</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="nb">type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ck2</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">ck2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sigma_bar_k_offset</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">sigma_bar_k_offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ck</span> <span class="o">=</span> <span class="n">ck</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vk</span> <span class="o">=</span> <span class="n">vk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ck2</span> <span class="o">=</span> <span class="n">ck2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_bar_k_offset</span> <span class="o">=</span> <span class="n">sigma_bar_k_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="s2">&quot;dims&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; dim=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; Q.dims=</span><span class="si">{</span><span class="n">dims</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; ck=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ck</span><span class="si">!r}</span><span class="s2"> vk=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vk</span><span class="si">!r}</span><span class="s2"> ck2=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ck2</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; sigma_bar_k_offset=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_bar_k_offset</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; tag=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="si">!r}</span><span class="s2">&gt;&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Bath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.Bath">[docs]</a><span class="k">class</span> <span class="nc">Bath</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a list of bath expansion exponents.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    exponents : list of BathExponent</span>
<span class="sd">        The exponents of the correlation function describing the bath.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    All of the parameters are available as attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponents</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exponents</span> <span class="o">=</span> <span class="n">exponents</span></div>


<div class="viewcode-block" id="BosonicBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.BosonicBath">[docs]</a><span class="k">class</span> <span class="nc">BosonicBath</span><span class="p">(</span><span class="n">Bath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a bosonic bath from the expansion</span>
<span class="sd">    coefficients and frequencies for the real and imaginary parts of</span>
<span class="sd">    the bath correlation function.</span>

<span class="sd">    If the correlation functions ``C(t)`` is split into real and imaginary</span>
<span class="sd">    parts::</span>

<span class="sd">        C(t) = C_real(t) + i * C_imag(t)</span>

<span class="sd">    then::</span>

<span class="sd">        C_real(t) = sum(ck_real * exp(- vk_real * t))</span>
<span class="sd">        C_imag(t) = sum(ck_imag * exp(- vk_imag * t))</span>

<span class="sd">    Defines the coefficients ``ck`` and the frequencies ``vk``.</span>

<span class="sd">    Note that the ``ck`` and ``vk`` may be complex, even through ``C_real(t)``</span>
<span class="sd">    and ``C_imag(t)`` (i.e. the sum) is real.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        The coupling operator for the bath.</span>

<span class="sd">    ck_real : list of complex</span>
<span class="sd">        The coefficients of the expansion terms for the real part of the</span>
<span class="sd">        correlation function. The corresponding frequencies are passed as</span>
<span class="sd">        vk_real.</span>

<span class="sd">    vk_real : list of complex</span>
<span class="sd">        The frequencies (exponents) of the expansion terms for the real part of</span>
<span class="sd">        the correlation function. The corresponding ceofficients are passed as</span>
<span class="sd">        ck_real.</span>

<span class="sd">    ck_imag : list of complex</span>
<span class="sd">        The coefficients of the expansion terms in the imaginary part of the</span>
<span class="sd">        correlation function. The corresponding frequencies are passed as</span>
<span class="sd">        vk_imag.</span>

<span class="sd">    vk_imag : list of complex</span>
<span class="sd">        The frequencies (exponents) of the expansion terms for the imaginary</span>
<span class="sd">        part of the correlation function. The corresponding ceofficients are</span>
<span class="sd">        passed as ck_imag.</span>

<span class="sd">    combine : bool, default True</span>
<span class="sd">        Whether to combine exponents with the same frequency (and coupling</span>
<span class="sd">        operator). See :meth:`combine` for details.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_check_cks_and_vks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_real</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_real</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_imag</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_imag</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The bath exponent lists ck_real and vk_real, and ck_imag and&quot;</span>
                <span class="s2">&quot; vk_imag must be the same length.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_coup_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The coupling operator Q must be a Qobj.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_cks_and_vks</span><span class="p">(</span><span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_coup_op</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

        <span class="n">exponents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">exponents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">BathExponent</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">exponents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">BathExponent</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">combine</span><span class="p">:</span>
            <span class="n">exponents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span>

<div class="viewcode-block" id="BosonicBath.combine"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.BosonicBath.combine">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">exponents</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Group bosonic exponents with the same frequency and return a</span>
<span class="sd">        single exponent for each frequency present.</span>

<span class="sd">        Exponents with the same frequency are only combined if they share the</span>
<span class="sd">        same coupling operator ``.Q``.</span>

<span class="sd">        Note that combined exponents take their tag from the first</span>
<span class="sd">        exponent in the group being combined (i.e. the one that occurs first</span>
<span class="sd">        in the given exponents list).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exponents : list of BathExponent</span>
<span class="sd">            The list of exponents to combine.</span>

<span class="sd">        rtol : float, default 1e-5</span>
<span class="sd">            The relative tolerance to use to when comparing frequencies and</span>
<span class="sd">            coupling operators.</span>

<span class="sd">        atol : float, default 1e-7</span>
<span class="sd">            The absolute tolerance to use to when comparing frequencies and</span>
<span class="sd">            coupling operators.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of BathExponent</span>
<span class="sd">            The new reduced list of exponents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="n">exponents</span><span class="p">[:]</span>

        <span class="k">while</span> <span class="n">remaining</span><span class="p">:</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">remaining</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">e1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">remaining</span><span class="p">[:]:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">vk</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">vk</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">e2</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
                    <span class="n">remaining</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

        <span class="n">new_exponents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combine</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">exp1</span> <span class="o">=</span> <span class="n">combine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">exp1</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">exp1</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">RI</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">exp2</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp1</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">exp2</span> <span class="ow">in</span> <span class="n">combine</span>
            <span class="p">):</span>
                <span class="c1"># the group is either type I or R</span>
                <span class="n">ck</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">combine</span><span class="p">)</span>
                <span class="n">new_exponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BathExponent</span><span class="p">(</span>
                    <span class="n">exp1</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exp1</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ck</span><span class="p">,</span> <span class="n">exp1</span><span class="o">.</span><span class="n">vk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">exp1</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># the group includes both type I and R exponents</span>
                <span class="n">ck_R</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">combine</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">combine</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">RI</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">ck_I</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">combine</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="o">+</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck2</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">combine</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">RI</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">new_exponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BathExponent</span><span class="p">(</span>
                    <span class="s2">&quot;RI&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exp1</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">ck_R</span><span class="p">,</span> <span class="n">exp1</span><span class="o">.</span><span class="n">vk</span><span class="p">,</span> <span class="n">ck2</span><span class="o">=</span><span class="n">ck_I</span><span class="p">,</span>
                    <span class="n">tag</span><span class="o">=</span><span class="n">exp1</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                <span class="p">))</span>

        <span class="k">return</span> <span class="n">new_exponents</span></div></div>


<div class="viewcode-block" id="DrudeLorentzBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.DrudeLorentzBath">[docs]</a><span class="k">class</span> <span class="nc">DrudeLorentzBath</span><span class="p">(</span><span class="n">BosonicBath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a Drude-Lorentz bosonic bath from the</span>
<span class="sd">    bath parameters (see parameters below).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        Operator describing the coupling between system and bath.</span>

<span class="sd">    lam : float</span>
<span class="sd">        Coupling strength.</span>

<span class="sd">    gamma : float</span>
<span class="sd">        Bath spectral density cutoff frequency.</span>

<span class="sd">    T : float</span>
<span class="sd">        Bath temperature.</span>

<span class="sd">    Nk : int</span>
<span class="sd">        Number of exponential terms used to approximate the bath correlation</span>
<span class="sd">        functions.</span>

<span class="sd">    combine : bool, default True</span>
<span class="sd">        Whether to combine exponents with the same frequency (and coupling</span>
<span class="sd">        operator). See :meth:`BosonicBath.combine` for details.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matsubara_params</span><span class="p">(</span>
            <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
            <span class="n">Nk</span><span class="o">=</span><span class="n">Nk</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">,</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="n">combine</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dl_terminator</span> <span class="o">=</span> <span class="n">_DrudeLorentzTerminator</span><span class="p">(</span>
            <span class="n">Q</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DrudeLorentzBath.terminator"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.DrudeLorentzBath.terminator">[docs]</a>    <span class="k">def</span> <span class="nf">terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Matsubara terminator for the bath and the calculated</span>
<span class="sd">        approximation discrepancy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        delta: float</span>

<span class="sd">            The approximation discrepancy. That is, the difference between the</span>
<span class="sd">            true correlation function of the Drude-Lorentz bath and the sum of</span>
<span class="sd">            the ``Nk`` exponential terms is approximately ``2 * delta *</span>
<span class="sd">            dirac(t)``, where ``dirac(t)`` denotes the Dirac delta function.</span>

<span class="sd">        terminator : Qobj</span>

<span class="sd">            The Matsubara terminator -- i.e. a liouvillian term representing</span>
<span class="sd">            the contribution to the system-bath dynamics of all exponential</span>
<span class="sd">            expansion terms beyond ``Nk``. It should be used by adding it to</span>
<span class="sd">            the system liouvillian (i.e. ``liouvillian(H_sys)``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dl_terminator</span><span class="o">.</span><span class="n">terminator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exponents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta</span><span class="p">,</span> <span class="n">L</span></div>

    <span class="k">def</span> <span class="nf">_matsubara_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the Matsubara coefficents and frequencies. &quot;&quot;&quot;</span>
        <span class="n">ck_real</span> <span class="o">=</span> <span class="p">[</span><span class="n">lam</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">T</span><span class="p">))]</span>
        <span class="n">ck_real</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">T</span> <span class="o">/</span>
                <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="n">vk_real</span> <span class="o">=</span> <span class="p">[</span><span class="n">gamma</span><span class="p">]</span>
        <span class="n">vk_real</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">T</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="n">ck_imag</span> <span class="o">=</span> <span class="p">[</span><span class="n">lam</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)]</span>
        <span class="n">vk_imag</span> <span class="o">=</span> <span class="p">[</span><span class="n">gamma</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span></div>


<div class="viewcode-block" id="DrudeLorentzPadeBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.DrudeLorentzPadeBath">[docs]</a><span class="k">class</span> <span class="nc">DrudeLorentzPadeBath</span><span class="p">(</span><span class="n">BosonicBath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a Pad expansion for a Drude-Lorentz</span>
<span class="sd">    bosonic bath from the bath parameters (see parameters below).</span>

<span class="sd">    A Pad approximant is a sum-over-poles expansion (</span>
<span class="sd">    see https://en.wikipedia.org/wiki/Pad%C3%A9_approximant).</span>

<span class="sd">    The application of the Pad method to spectrum decompoisitions is described</span>
<span class="sd">    in &quot;Pad spectrum decompositions of quantum distribution functions and</span>
<span class="sd">    optimal hierarchical equations of motion construction for quantum open</span>
<span class="sd">    systems&quot; [1].</span>

<span class="sd">    The implementation here follows the approach in the paper.</span>

<span class="sd">    [1] J. Chem. Phys. 134, 244106 (2011); https://doi.org/10.1063/1.3602466</span>

<span class="sd">    This is an alternative to the :class:`DrudeLorentzBath` which constructs</span>
<span class="sd">    a simpler exponential expansion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        Operator describing the coupling between system and bath.</span>

<span class="sd">    lam : float</span>
<span class="sd">        Coupling strength.</span>

<span class="sd">    gamma : float</span>
<span class="sd">        Bath spectral density cutoff frequency.</span>

<span class="sd">    T : float</span>
<span class="sd">        Bath temperature.</span>

<span class="sd">    Nk : int</span>
<span class="sd">        Number of Pad exponentials terms used to approximate the bath</span>
<span class="sd">        correlation functions.</span>

<span class="sd">    combine : bool, default True</span>
<span class="sd">        Whether to combine exponents with the same frequency (and coupling</span>
<span class="sd">        operator). See :meth:`BosonicBath.combine` for details.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">eta_p</span><span class="p">,</span> <span class="n">gamma_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="o">=</span><span class="n">Nk</span><span class="p">)</span>

        <span class="n">ck_real</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="k">for</span> <span class="n">eta</span> <span class="ow">in</span> <span class="n">eta_p</span><span class="p">]</span>
        <span class="n">vk_real</span> <span class="o">=</span> <span class="p">[</span><span class="n">gam</span> <span class="k">for</span> <span class="n">gam</span> <span class="ow">in</span> <span class="n">gamma_p</span><span class="p">]</span>
        <span class="c1"># There is only one term in the expansion of the imaginary part of the</span>
        <span class="c1"># Drude-Lorentz correlation function.</span>
        <span class="n">ck_imag</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eta_p</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">vk_imag</span> <span class="o">=</span> <span class="p">[</span><span class="n">gamma_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">,</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="n">combine</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dl_terminator</span> <span class="o">=</span> <span class="n">_DrudeLorentzTerminator</span><span class="p">(</span>
            <span class="n">Q</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="DrudeLorentzPadeBath.terminator"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.DrudeLorentzPadeBath.terminator">[docs]</a>    <span class="k">def</span> <span class="nf">terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Pad terminator for the bath and the calculated</span>
<span class="sd">        approximation discrepancy.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        delta: float</span>

<span class="sd">            The approximation discrepancy. That is, the difference between the</span>
<span class="sd">            true correlation function of the Drude-Lorentz bath and the sum of</span>
<span class="sd">            the ``Nk`` exponential terms is approximately ``2 * delta *</span>
<span class="sd">            dirac(t)``, where ``dirac(t)`` denotes the Dirac delta function.</span>

<span class="sd">        terminator : Qobj</span>

<span class="sd">            The Pad terminator -- i.e. a liouvillian term representing</span>
<span class="sd">            the contribution to the system-bath dynamics of all exponential</span>
<span class="sd">            expansion terms beyond ``Nk``. It should be used by adding it to</span>
<span class="sd">            the system liouvillian (i.e. ``liouvillian(H_sys)``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delta</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dl_terminator</span><span class="o">.</span><span class="n">terminator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exponents</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta</span><span class="p">,</span> <span class="n">L</span></div>

    <span class="k">def</span> <span class="nf">_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span>
        <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kappa_epsilon</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>

        <span class="n">eta_p</span> <span class="o">=</span> <span class="p">[</span><span class="n">lam</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cot</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="n">j</span><span class="p">)]</span>
        <span class="n">gamma_p</span> <span class="o">=</span> <span class="p">[</span><span class="n">gamma</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">eta_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">((</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">gamma_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">eta_p</span><span class="p">,</span> <span class="n">gamma_p</span>

    <span class="k">def</span> <span class="nf">_cot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_kappa_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_eps</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_chi</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>

        <span class="n">kappa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prefactor</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">prefactor</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">term</span> <span class="o">*=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">chi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span>
                    <span class="p">(</span><span class="n">eps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">term</span> <span class="o">/=</span> <span class="p">(</span><span class="n">eps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
            <span class="n">kappa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

        <span class="n">epsilon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span>

        <span class="k">return</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span>

    <span class="k">def</span> <span class="nf">_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">_calc_eps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
                <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">+=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">evals</span> <span class="o">=</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">Nk</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">eps</span>

    <span class="k">def</span> <span class="nf">_calc_chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
                <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha_p</span> <span class="o">+=</span> <span class="n">alpha_p</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">evals</span> <span class="o">=</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha_p</span><span class="p">)</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">chi</span></div>


<span class="k">class</span> <span class="nc">_DrudeLorentzTerminator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A class for calculating the terminator of a Drude-Lorentz bath</span>
<span class="sd">        expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the terminator for a Drude-Lorentz bath. &quot;&quot;&quot;</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lam</span> <span class="o">/</span> <span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">lam</span>

        <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exponents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">BathExponent</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">]:</span>
                <span class="n">delta</span> <span class="o">-=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="o">/</span> <span class="n">exp</span><span class="o">.</span><span class="n">vk</span>
            <span class="k">elif</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">BathExponent</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;RI&quot;</span><span class="p">]:</span>
                <span class="n">delta</span> <span class="o">-=</span> <span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">exp</span><span class="o">.</span><span class="n">ck2</span><span class="p">)</span> <span class="o">/</span> <span class="n">exp</span><span class="o">.</span><span class="n">vk</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">-=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">exp</span><span class="o">.</span><span class="n">ck</span> <span class="o">/</span> <span class="n">exp</span><span class="o">.</span><span class="n">vk</span>

        <span class="n">op</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">spre</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="n">spost</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">dag</span><span class="p">())</span> <span class="o">+</span> <span class="n">spre</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span><span class="o">*</span><span class="n">Q</span><span class="p">)</span> <span class="o">+</span> <span class="n">spost</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span><span class="o">*</span><span class="n">Q</span><span class="p">)</span>
        <span class="n">L_bnd</span> <span class="o">=</span> <span class="o">-</span><span class="n">delta</span> <span class="o">*</span> <span class="n">op</span>

        <span class="k">return</span> <span class="n">delta</span><span class="p">,</span> <span class="n">L_bnd</span>


<div class="viewcode-block" id="UnderDampedBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.UnderDampedBath">[docs]</a><span class="k">class</span> <span class="nc">UnderDampedBath</span><span class="p">(</span><span class="n">BosonicBath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing an under-damped bosonic bath from the</span>
<span class="sd">    bath parameters (see parameters below).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        Operator describing the coupling between system and bath.</span>

<span class="sd">    lam : float</span>
<span class="sd">        Coupling strength.</span>

<span class="sd">    gamma : float</span>
<span class="sd">        Bath spectral density cutoff frequency.</span>

<span class="sd">    w0 : float</span>
<span class="sd">        Bath spectral density resonance frequency.</span>

<span class="sd">    T : float</span>
<span class="sd">        Bath temperature.</span>

<span class="sd">    Nk : int</span>
<span class="sd">        Number of exponential terms used to approximate the bath correlation</span>
<span class="sd">        functions.</span>

<span class="sd">    combine : bool, default True</span>
<span class="sd">        Whether to combine exponents with the same frequency (and coupling</span>
<span class="sd">        operator). See :meth:`BosonicBath.combine` for details.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matsubara_params</span><span class="p">(</span>
            <span class="n">lam</span><span class="o">=</span><span class="n">lam</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">w0</span><span class="o">=</span><span class="n">w0</span><span class="p">,</span>
            <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
            <span class="n">Nk</span><span class="o">=</span><span class="n">Nk</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">,</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="n">combine</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_matsubara_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate the Matsubara coefficents and frequencies. &quot;&quot;&quot;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">T</span>
        <span class="n">Om</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">w0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span>

        <span class="n">ck_real</span> <span class="o">=</span> <span class="p">([</span>
            <span class="p">(</span><span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Om</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">Om</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Gamma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">Om</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">Om</span> <span class="o">-</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Gamma</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span>
        <span class="p">])</span>

        <span class="n">ck_real</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">Om</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">((</span><span class="n">Om</span> <span class="o">-</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">vk_real</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Om</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">,</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Om</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">]</span>
        <span class="n">vk_real</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">T</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">ck_imag</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Om</span><span class="p">),</span>
            <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Om</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">vk_imag</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Om</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">,</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">Om</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ck_real</span><span class="p">,</span> <span class="n">vk_real</span><span class="p">,</span> <span class="n">ck_imag</span><span class="p">,</span> <span class="n">vk_imag</span></div>


<div class="viewcode-block" id="FermionicBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.FermionicBath">[docs]</a><span class="k">class</span> <span class="nc">FermionicBath</span><span class="p">(</span><span class="n">Bath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a fermionic bath from the expansion</span>
<span class="sd">    coefficients and frequencies for the ``+`` and ``-`` modes of</span>
<span class="sd">    the bath correlation function.</span>

<span class="sd">    There must be the same number of ``+`` and ``-`` modes and their</span>
<span class="sd">    coefficients must be specified in the same order so that ``ck_plus[i],</span>
<span class="sd">    vk_plus[i]`` are the plus coefficient and frequency corresponding</span>
<span class="sd">    to the minus mode ``ck_minus[i], vk_minus[i]``.</span>

<span class="sd">    In the fermionic case the order in which excitations are created or</span>
<span class="sd">    destroyed is important, resulting in two different correlation functions</span>
<span class="sd">    labelled ``C_plus(t)`` and ``C_plus(t)``::</span>

<span class="sd">        C_plus(t) = sum(ck_plus * exp(- vk_plus * t))</span>
<span class="sd">        C_minus(t) = sum(ck_minus * exp(- vk_minus * t))</span>

<span class="sd">    where the expansions above define the coeffiients ``ck`` and the</span>
<span class="sd">    frequencies ``vk``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        The coupling operator for the bath.</span>

<span class="sd">    ck_plus : list of complex</span>
<span class="sd">        The coefficients of the expansion terms for the ``+`` part of the</span>
<span class="sd">        correlation function. The corresponding frequencies are passed as</span>
<span class="sd">        vk_plus.</span>

<span class="sd">    vk_plus : list of complex</span>
<span class="sd">        The frequencies (exponents) of the expansion terms for the ``+`` part</span>
<span class="sd">        of the correlation function. The corresponding ceofficients are passed</span>
<span class="sd">        as ck_plus.</span>

<span class="sd">    ck_minus : list of complex</span>
<span class="sd">        The coefficients of the expansion terms for the ``-`` part of the</span>
<span class="sd">        correlation function. The corresponding frequencies are passed as</span>
<span class="sd">        vk_minus.</span>

<span class="sd">    vk_minus : list of complex</span>
<span class="sd">        The frequencies (exponents) of the expansion terms for the ``-`` part</span>
<span class="sd">        of the correlation function. The corresponding ceofficients are passed</span>
<span class="sd">        as ck_minus.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_check_cks_and_vks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_plus</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_plus</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_minus</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vk_minus</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The bath exponent lists ck_plus and vk_plus, and ck_minus and&quot;</span>
                <span class="s2">&quot; vk_minus must be the same length.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_plus</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ck_minus</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The must be the same number of plus and minus exponents&quot;</span>
                <span class="s2">&quot; in the bath, and elements of plus and minus arrays&quot;</span>
                <span class="s2">&quot; should be arranged so that ck_plus[i] is the plus mode&quot;</span>
                <span class="s2">&quot; corresponding to ck_minus[i].&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_coup_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">Qobj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The coupling operator Q must be a Qobj.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_cks_and_vks</span><span class="p">(</span><span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_coup_op</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

        <span class="n">exponents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ckp</span><span class="p">,</span> <span class="n">vkp</span><span class="p">,</span> <span class="n">ckm</span><span class="p">,</span> <span class="n">vkm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">):</span>
            <span class="n">exponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BathExponent</span><span class="p">(</span>
                <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ckp</span><span class="p">,</span> <span class="n">vkp</span><span class="p">,</span> <span class="n">sigma_bar_k_offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
            <span class="p">))</span>
            <span class="n">exponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BathExponent</span><span class="p">(</span>
                <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">ckm</span><span class="p">,</span> <span class="n">vkm</span><span class="p">,</span> <span class="n">sigma_bar_k_offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
            <span class="p">))</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">exponents</span><span class="p">)</span></div>


<div class="viewcode-block" id="LorentzianBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.LorentzianBath">[docs]</a><span class="k">class</span> <span class="nc">LorentzianBath</span><span class="p">(</span><span class="n">FermionicBath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a Lorentzian fermionic bath from the</span>
<span class="sd">    bath parameters (see parameters below).</span>

<span class="sd">    .. note::</span>

<span class="sd">        This Matsubara expansion used in this bath converges very slowly</span>
<span class="sd">        and ``Nk &gt; 20`` may be required to get good convergence. The</span>
<span class="sd">        Pad expansion used by :class:`LorentzianPadeBath` converges much</span>
<span class="sd">        more quickly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        Operator describing the coupling between system and bath.</span>

<span class="sd">    gamma : float</span>
<span class="sd">        The coupling strength between the system and the bath.</span>

<span class="sd">    w : float</span>
<span class="sd">        The width of the environment.</span>

<span class="sd">    mu : float</span>
<span class="sd">        The chemical potential of the bath.</span>

<span class="sd">    T : float</span>
<span class="sd">        Bath temperature.</span>

<span class="sd">    Nk : int</span>
<span class="sd">        Number of exponential terms used to approximate the bath correlation</span>
<span class="sd">        functions.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">,</span> <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span>
        <span class="n">kappa</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">1.</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">epsilon</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ll</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">eta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">w</span><span class="p">)]</span>
        <span class="n">gamma_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">eta_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span>
                <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">gamma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">eta_list</span><span class="p">,</span> <span class="n">gamma_list</span></div>


<div class="viewcode-block" id="LorentzianPadeBath"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.nonmarkov.heom.LorentzianPadeBath">[docs]</a><span class="k">class</span> <span class="nc">LorentzianPadeBath</span><span class="p">(</span><span class="n">FermionicBath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper class for constructing a Pad expansion for Lorentzian fermionic</span>
<span class="sd">    bath from the bath parameters (see parameters below).</span>

<span class="sd">    A Pad approximant is a sum-over-poles expansion (</span>
<span class="sd">    see https://en.wikipedia.org/wiki/Pad%C3%A9_approximant).</span>

<span class="sd">    The application of the Pad method to spectrum decompoisitions is described</span>
<span class="sd">    in &quot;Pad spectrum decompositions of quantum distribution functions and</span>
<span class="sd">    optimal hierarchical equations of motion construction for quantum open</span>
<span class="sd">    systems&quot; [1].</span>

<span class="sd">    The implementation here follows the approach in the paper.</span>

<span class="sd">    [1] J. Chem. Phys. 134, 244106 (2011); https://doi.org/10.1063/1.3602466</span>

<span class="sd">    This is an alternative to the :class:`LorentzianBath` which constructs</span>
<span class="sd">    a simpler exponential expansion that converges much more slowly in</span>
<span class="sd">    this particular case.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q : Qobj</span>
<span class="sd">        Operator describing the coupling between system and bath.</span>

<span class="sd">    gamma : float</span>
<span class="sd">        The coupling strength between the system and the bath.</span>

<span class="sd">    w : float</span>
<span class="sd">        The width of the environment.</span>

<span class="sd">    mu : float</span>
<span class="sd">        The chemical potential of the bath.</span>

<span class="sd">    T : float</span>
<span class="sd">        Bath temperature.</span>

<span class="sd">    Nk : int</span>
<span class="sd">        Number of exponential terms used to approximate the bath correlation</span>
<span class="sd">        functions.</span>

<span class="sd">    tag : optional, str, tuple or any other object</span>
<span class="sd">        A label for the bath exponents (for example, the name of the</span>
<span class="sd">        bath). It defaults to None but can be set to help identify which</span>
<span class="sd">        bath an exponent is from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corr</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">Q</span><span class="p">,</span> <span class="n">ck_plus</span><span class="p">,</span> <span class="n">vk_plus</span><span class="p">,</span> <span class="n">ck_minus</span><span class="p">,</span> <span class="n">vk_minus</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span>
        <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kappa_epsilon</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f_approx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>

        <span class="n">eta_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">f_approx</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">w</span><span class="p">)]</span>
        <span class="n">gamma_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">eta_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">gamma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">eta_list</span><span class="p">,</span> <span class="n">gamma_list</span>

    <span class="k">def</span> <span class="nf">_kappa_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_eps</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_chi</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>

        <span class="n">kappa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prefactor</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">prefactor</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">term</span> <span class="o">*=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">chi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span>
                    <span class="p">(</span><span class="n">eps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">term</span> <span class="o">/=</span> <span class="p">(</span><span class="n">eps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
            <span class="n">kappa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

        <span class="n">epsilon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span>

        <span class="k">return</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span>

    <span class="k">def</span> <span class="nf">_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">_calc_eps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
                <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">+=</span> <span class="n">alpha</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="n">evals</span> <span class="o">=</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">Nk</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">eps</span>

    <span class="k">def</span> <span class="nf">_calc_chi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span>
                <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha_p</span> <span class="o">+=</span> <span class="n">alpha_p</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">evals</span> <span class="o">=</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha_p</span><span class="p">)</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">chi</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; <a href="../../../copyright.html">Copyright</a> 2011 to 2021 inclusive, QuTiP developers and contributors.
      <span class="lastupdated">
        Last updated on Jan 29, 2024.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>