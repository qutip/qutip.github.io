


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Fermionic Environments &mdash; QuTiP 4.7 Documentation</title>
  

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../static/gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../static/site.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script src="../../static/jquery.js"></script>
        <script src="../../static/underscore.js"></script>
        <script src="../../static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"bra": ["\\left\\langle{#1}\\right\\rvert", 1], "ket": ["\\left\\lvert{#1}\\right\\rangle", 1], "tr": "\\operatorname{tr}"}}})</script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Previous implementations" href="history.html" />
    <link rel="prev" title="Bosonic Environments" href="bosonic.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
              <div class="version">
                4.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guide.html">Users Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../guide-overview.html">Guide Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-basics.html">Basic Operations on Quantum Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-states.html">Manipulating States and Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-tensor.html">Using Tensor Products and Partial Traces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-dynamics.html">Time Evolution and Quantum System Dynamics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../guide-heom.html">Hierarchical Equations of Motion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="bosonic.html">Bosonic Environments</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fermionic Environments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#describing-the-system-and-bath">Describing the system and bath</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-and-bath-dynamics">System and bath dynamics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#determining-currents">Determining currents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#steady-state-currents">Steady state currents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pade-expansion-coefficients">Padé expansion coefficients</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="history.html">Previous implementations</a></li>
<li class="toctree-l3"><a class="reference internal" href="references.html">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide-steady.html">Solving for Steady-State Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-correlation.html">Two-time correlation functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-control.html">Quantum Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-bloch.html">Plotting on the Bloch Sphere</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-visualization.html">Visualization of quantum states and processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-parfor.html">Parallel computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-saving.html">Saving QuTiP Objects and Data Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-random.html">Generating Random Quantum States &amp; Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-settings.html">Modifying Internal QuTiP Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-qip.html">Quantum Information Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide-measurement.html">Measurement of Quantum Objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/build/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/development.html">Development Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../biblio.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright and Licensing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../guide.html">Users Guide</a> &raquo;</li>
        
          <li><a href="../guide-heom.html">Hierarchical Equations of Motion</a> &raquo;</li>
        
      <li>Fermionic Environments</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fermionic-environments">
<h1>Fermionic Environments<a class="headerlink" href="#fermionic-environments" title="Permalink to this headline">¶</a></h1>
<p>Here we model a single fermion coupled to two electronic leads or reservoirs
(e.g.,  this can describe a single quantum dot, a molecular transistor, etc).
The system hamiltonian, <span class="math notranslate nohighlight">\(H_{sys}\)</span>, and bath spectral density, <span class="math notranslate nohighlight">\(J_D\)</span>,
are</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}H_{sys} &amp;= c^{\dagger} c\\J_D &amp;= \frac{\Gamma W^2}{(w - \mu)^2 + W^2},\end{aligned}\end{align} \]</div>
<p>We will demonstrate how to describe the bath using two different expansions
of the spectral density correlation function (Matsubara’s expansion and
a Padé expansion), how to evolve the system in time, and how to calculate
the steady state.</p>
<p>Since our fermion is coupled to two reservoirs, we will construct two baths –
one for each reservoir or lead – and call them the left (<span class="math notranslate nohighlight">\(L\)</span>) and right
(<span class="math notranslate nohighlight">\(R\)</span>) baths for convenience. Each bath will have a different chemical
potential <span class="math notranslate nohighlight">\(\mu\)</span> which we will label <span class="math notranslate nohighlight">\(\mu_L\)</span> and <span class="math notranslate nohighlight">\(\mu_R\)</span>.</p>
<p>First we will do this using the built-in implementations of the bath expansions,
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.LorentzianBath" title="qutip.nonmarkov.heom.LorentzianBath"><code class="xref py py-class docutils literal notranslate"><span class="pre">LorentzianBath</span></code></a> and
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.LorentzianPadeBath" title="qutip.nonmarkov.heom.LorentzianPadeBath"><code class="xref py py-class docutils literal notranslate"><span class="pre">LorentzianPadeBath</span></code></a>.</p>
<p>Afterwards, we will show how to calculate the bath expansion coefficients and to
use those coefficients to construct your own bath description so that you can
implement your own fermionic baths.</p>
<p>Our implementation of fermionic baths primarily follows the definitions used by
Christian Schinabeck in his dissertation (
<a class="reference external" href="https://opus4.kobv.de/opus4-fau/files/10984/DissertationChristianSchinabeck.pdf">https://opus4.kobv.de/opus4-fau/files/10984/DissertationChristianSchinabeck.pdf</a>
) and related publications.</p>
<p>A notebook containing a complete example similar to this one implemented in
BoFiN can be found in <a class="reference external" href="https://github.com/tehruhn/bofin/blob/main/examples/example-4b-fermions-single-impurity-model.ipynb">example notebook 4b</a>.</p>
<div class="section" id="describing-the-system-and-bath">
<h2>Describing the system and bath<a class="headerlink" href="#describing-the-system-and-bath" title="Permalink to this headline">¶</a></h2>
<p>First, let us construct the system Hamiltonian, <span class="math notranslate nohighlight">\(H_{sys}\)</span>, and the initial
system state, <code class="docutils literal notranslate"><span class="pre">rho0</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">basis</span><span class="p">,</span> <span class="n">destroy</span>

<span class="c1"># The system Hamiltonian:</span>
<span class="n">e1</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># site energy</span>
<span class="n">H_sys</span> <span class="o">=</span> <span class="n">e1</span> <span class="o">*</span> <span class="n">destroy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">destroy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Initial state of the system:</span>
<span class="n">rho0</span> <span class="o">=</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let us describe the bath properties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shared bath properties:</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.01</span>   <span class="c1"># coupling strength</span>
<span class="n">W</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># cut-off</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">0.025851991</span>  <span class="c1"># temperature</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span>

<span class="c1"># Chemical potentials for the two baths:</span>
<span class="n">mu_L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">mu_R</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>

<span class="c1"># System-bath coupling operator:</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">destroy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(\Gamma\)</span> (<code class="docutils literal notranslate"><span class="pre">gamma</span></code>), <span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(T\)</span> are the parameters of
an Lorentzian bath, <span class="math notranslate nohighlight">\(\mu_L\)</span> (<code class="docutils literal notranslate"><span class="pre">mu_L</span></code>) and <span class="math notranslate nohighlight">\(\mu_R\)</span> (<code class="docutils literal notranslate"><span class="pre">mu_R</span></code>) are
the chemical potentials of the left and right baths, and <code class="docutils literal notranslate"><span class="pre">Q</span></code> is the coupling
operator between the system and the baths.</p>
<p>We may the pass these parameters to either <code class="docutils literal notranslate"><span class="pre">LorentzianBath</span></code> or
<code class="docutils literal notranslate"><span class="pre">LorentzianPadeBath</span></code> to construct an expansion of the bath correlations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qutip.nonmarkov.heom</span> <span class="kn">import</span> <span class="n">LorentzianBath</span>
<span class="kn">from</span> <span class="nn">qutip.nonmarkov.heom</span> <span class="kn">import</span> <span class="n">LorentzianPadeBath</span>

<span class="c1"># Number of expansion terms to retain:</span>
<span class="n">Nk</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Matsubara expansion:</span>
<span class="n">bath_L</span> <span class="o">=</span> <span class="n">LorentzianBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">mu_L</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="n">bath_R</span> <span class="o">=</span> <span class="n">LorentzianBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">mu_R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>

<span class="c1"># Padé expansion:</span>
<span class="n">bath_L</span> <span class="o">=</span> <span class="n">LorentzianPadeBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">mu_L</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="n">bath_R</span> <span class="o">=</span> <span class="n">LorentzianPadeBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">mu_R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nk</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">Nk</span></code> is the number of terms to retain within the expansion of the
bath.</p>
<p>Note that we haved labelled each bath with a tag (either “L” or “R”) so that
we can identify the exponents from individual baths later when calculating
the currents between the system and the bath.</p>
</div>
<div class="section" id="system-and-bath-dynamics">
<h2>System and bath dynamics<a class="headerlink" href="#system-and-bath-dynamics" title="Permalink to this headline">¶</a></h2>
<p>Now we are ready to construct a solver:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qutip.nonmarkov.heom</span> <span class="kn">import</span> <span class="n">HEOMSolver</span>
<span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">Options</span>

<span class="n">max_depth</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># maximum hierarchy depth to retain</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">15_000</span><span class="p">)</span>
<span class="n">baths</span> <span class="o">=</span> <span class="p">[</span><span class="n">bath_L</span><span class="p">,</span> <span class="n">bath_R</span><span class="p">]</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">HEOMSolver</span><span class="p">(</span><span class="n">H_sys</span><span class="p">,</span> <span class="n">baths</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>and to calculate the system evolution as a function of time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tlist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>  <span class="c1"># times to evaluate the system state at</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">tlist</span><span class="p">)</span>
</pre></div>
</div>
<p>As in the bosonic case, the <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> parameter determines how many levels
of the hierarchy to retain.</p>
<p>As in the bosonic case, we can specify <code class="docutils literal notranslate"><span class="pre">e_ops</span></code> in order to retrieve the
expectation values of operators at each given time. See
<a class="reference internal" href="bosonic.html#heom-bosonic-system-and-bath-dynamics"><span class="std std-ref">System and bath dynamics</span></a> for a fuller description of
the returned <code class="docutils literal notranslate"><span class="pre">result</span></code> object.</p>
<p>Below we run the solver again, but use <code class="docutils literal notranslate"><span class="pre">e_ops</span></code> to store the expectation
values of the population of the system states:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the operators that measure the populations of the two</span>
<span class="c1"># system states:</span>
<span class="n">P11p</span> <span class="o">=</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
<span class="n">P22p</span> <span class="o">=</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>

<span class="c1"># Run the solver:</span>
<span class="n">tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">e_ops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;11&quot;</span><span class="p">:</span> <span class="n">P11p</span><span class="p">,</span> <span class="s2">&quot;22&quot;</span><span class="p">:</span> <span class="n">P22p</span><span class="p">})</span>

<span class="c1"># Plot the results:</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;11&quot;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;P11&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;22&quot;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;P22&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="../../images/fermionic-5.png" src="../../images/fermionic-5.png" />
</div>
<p>The plot above is not very exciting. What we would really like to see in
this case are the currents between the system and the two baths. We will plot
these in the next section using the auxiliary density operators (ADOs)
returned by the solver.</p>
</div>
<div class="section" id="determining-currents">
<span id="heom-determining-currents"></span><h2>Determining currents<a class="headerlink" href="#determining-currents" title="Permalink to this headline">¶</a></h2>
<p>The currents between the system and a fermionic bath may be calculated from the
first level auxiliary density operators (ADOs) associated with the exponents
of that bath.</p>
<p>The contribution to the current into a given bath from each exponent in that
bath is:</p>
<div class="math notranslate nohighlight">
\[\mathrm{Contribution from Exponent} = \pm i \mathrm{Tr}(Q^\pm \cdot A)\]</div>
<p>where the <span class="math notranslate nohighlight">\(\pm\)</span> sign is the sign of the exponent (see the
description later in <a class="reference internal" href="#heom-fermionic-pade-expansion-coefficients"><span class="std std-ref">Padé expansion coefficients</span></a>) and
<span class="math notranslate nohighlight">\(Q^\pm\)</span> is <span class="math notranslate nohighlight">\(Q\)</span> for <code class="docutils literal notranslate"><span class="pre">+</span></code> exponents and <span class="math notranslate nohighlight">\(Q^{\dagger}\)</span> for
<code class="docutils literal notranslate"><span class="pre">-</span></code> exponents.</p>
<p>The first-level exponents for the left bath are retrieved by calling
<code class="docutils literal notranslate"><span class="pre">.filter(tags=[&quot;L&quot;])</span></code> on <code class="docutils literal notranslate"><span class="pre">ado_state</span></code> which is an instance of
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.HierarchyADOsState" title="qutip.nonmarkov.heom.HierarchyADOsState"><code class="xref py py-class docutils literal notranslate"><span class="pre">HierarchyADOsState</span></code></a> and also provides access to
the methods of <a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.HierarchyADOs" title="qutip.nonmarkov.heom.HierarchyADOs"><code class="xref py py-class docutils literal notranslate"><span class="pre">HierarchyADOs</span></code></a> which describes the
structure of the hierarchy for a given problem.</p>
<p>Here the tag “L” matches the tag passed when constructing <code class="docutils literal notranslate"><span class="pre">bath_L</span></code> earlier
in this example.</p>
<p>Similarly, we may calculate the current to the right bath from the exponents
tagged with “R”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">exp_current</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the current for a single exponent. &quot;&quot;&quot;</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">Q</span> <span class="k">if</span> <span class="n">exp</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">exp</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">exp</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">dag</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">sign</span> <span class="o">*</span> <span class="p">(</span><span class="n">op</span> <span class="o">*</span> <span class="n">aux</span><span class="p">)</span><span class="o">.</span><span class="n">tr</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">heom_current</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">ado_state</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the current between the system and the given bath. &quot;&quot;&quot;</span>
    <span class="n">level_1_ados</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">ado_state</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">ado_state</span><span class="o">.</span><span class="n">exps</span><span class="p">(</span><span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ado_state</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">exp_current</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span> <span class="k">for</span> <span class="n">aux</span><span class="p">,</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">level_1_ados</span><span class="p">))</span>

<span class="n">heom_left_current</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">ado_state</span><span class="p">:</span> <span class="n">heom_current</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">ado_state</span><span class="p">)</span>
<span class="n">heom_right_current</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">ado_state</span><span class="p">:</span> <span class="n">heom_current</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">ado_state</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we have defined functions for retrieving the currents for the
baths, we can pass them to <code class="docutils literal notranslate"><span class="pre">e_ops</span></code> and plot the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the solver (returning ADO states):</span>
<span class="n">tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">tlist</span><span class="p">,</span> <span class="n">e_ops</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;left_currents&quot;</span><span class="p">:</span> <span class="n">heom_left_current</span><span class="p">,</span>
    <span class="s2">&quot;right_currents&quot;</span><span class="p">:</span> <span class="n">heom_right_current</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># Plot the results:</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;left_currents&quot;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Bath L&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;right_currents&quot;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Bath R&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Current&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;System to Bath Currents&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="../../images/fermionic-7.png" src="../../images/fermionic-7.png" />
</div>
<p>And now we have a more interesting plot that shows the currents to the
left and right baths decaying towards their steady states!</p>
<p>In the next section, we will calculate the steady state currents directly.</p>
</div>
<div class="section" id="steady-state-currents">
<h2>Steady state currents<a class="headerlink" href="#steady-state-currents" title="Permalink to this headline">¶</a></h2>
<p>Using the same solver, we can also determine the steady state of the
combined system and bath using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">steady_state</span><span class="p">,</span> <span class="n">steady_ados</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">steady_state</span><span class="p">()</span>
</pre></div>
</div>
<p>and calculate the steady state currents to the two baths from <code class="docutils literal notranslate"><span class="pre">steady_ados</span></code>
using the same <code class="docutils literal notranslate"><span class="pre">heom_current</span></code> function we defined previously:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">steady_state_current_left</span> <span class="o">=</span> <span class="n">heom_current</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">steady_ados</span><span class="p">)</span>
<span class="n">steady_state_current_right</span> <span class="o">=</span> <span class="n">heom_current</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">steady_ados</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can add the steady state currents to the previous plot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the results and steady state currents:</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;left_currents&quot;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Bath L&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="p">[</span><span class="n">steady_state_current_left</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">),</span> <span class="s1">&#39;b:&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Bath L (steady state)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">expect</span><span class="p">[</span><span class="s2">&quot;right_currents&quot;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Bath R&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="p">[</span><span class="n">steady_state_current_right</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">times</span><span class="p">),</span> <span class="s1">&#39;r:&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Bath R (steady state)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Current&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;System to Bath Currents (with steady states)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="../../images/fermionic-10.png" src="../../images/fermionic-10.png" />
</div>
<p>As you can see, there is still some way to go beyond <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">100</span></code> before the
steady state is reached!</p>
</div>
<div class="section" id="pade-expansion-coefficients">
<span id="heom-fermionic-pade-expansion-coefficients"></span><h2>Padé expansion coefficients<a class="headerlink" href="#pade-expansion-coefficients" title="Permalink to this headline">¶</a></h2>
<p>We now look at how to calculate the correlation expansion coefficients for the
Lorentzian spectral density ourselves. Once we have calculated the coefficients
we can construct a <a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.FermionicBath" title="qutip.nonmarkov.heom.FermionicBath"><code class="xref py py-class docutils literal notranslate"><span class="pre">FermionicBath</span></code></a> directly from
them. A similar procedure can be used to apply
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.HEOMSolver" title="qutip.nonmarkov.heom.HEOMSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">HEOMSolver</span></code></a> to any fermionic bath for which we can
calculate the expansion coefficients.</p>
<p>In the fermionic case we must descriminate between the order in which
excitations are created within the bath, so we define two different correlation
functions, <span class="math notranslate nohighlight">\(C_{+}(t)\)</span>, and <span class="math notranslate nohighlight">\(C_{-}(t)\)</span>:</p>
<div class="math notranslate nohighlight">
\[C^{\sigma}(t) = \frac{1}{2\pi} \int_{-\infty}^{\infty} d\omega e^{\sigma i \omega t} J(\omega) f_F[\sigma\beta(\omega - \mu)]\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma\)</span> is either <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> and, <span class="math notranslate nohighlight">\(f_F\)</span> is the Fermi
distribution function, and <span class="math notranslate nohighlight">\(J(\omega)\)</span> is the Lorentzian spectral density
we defined at the start.</p>
<p>The Fermi distribution function is:</p>
<div class="math notranslate nohighlight">
\[f_F (x) = (\exp(x) + 1)^{-1}\]</div>
<p>As in the bosonic case we can approximate this integral with a Matsubara or
Padé expansion. For the Lorentzian bath the Padé expansion converges much
more quickly, so we will calculate the Padé expansion coefficients here.</p>
<p>The Padé decomposition approximates the Fermi distribution as:</p>
<div class="math notranslate nohighlight">
\[f_F(x) \approx f_F^{\mathrm{approx}}(x) = \frac{1}{2} - \sum_{l=0}^{Nk} \frac{2k_l x}{x^2 + \epsilon_l^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_l\)</span> and <span class="math notranslate nohighlight">\(\epsilon_l\)</span> are coefficients defined in
<a class="reference external" href="https://doi.org/10.1063/1.3491098">J. Chem Phys 133, “Efficient on the fly calculation of time correlation functions in computer simulations”</a>,
and <span class="math notranslate nohighlight">\(Nk\)</span> specifies the cut-off in the expansion.</p>
<p>Evaluating the integral for the correlation functions gives:</p>
<div class="math notranslate nohighlight">
\[C^{\sigma}(t) \approx \sum_{l=0}^{Nk} \eta^{\sigma,l} e^{-\gamma_{\sigma,l}t}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}\eta_{\sigma, l} &amp;= \begin{cases}
    \frac{\Gamma W}{2} f_F^{approx}(i\beta W)  &amp; l = 0\\
    -i\cdot \frac{k_l}{\beta} \cdot \frac{\Gamma W^2}{-\frac{\epsilon^2_l}{\beta^2} + W^2}  &amp; l \neq 0\\
\end{cases}\end{split}\\\begin{split}\gamma_{\sigma,l} &amp;= \begin{cases}
    W - \sigma i\mu  &amp; l = 0\\
    \frac{\epsilon_l}{\beta} - \sigma i \mu  &amp; l \neq 0\\
\end{cases}\end{split}\end{aligned}\end{align} \]</div>
<p>and <span class="math notranslate nohighlight">\(\beta = \frac{1}{T}\)</span>.</p>
<p>And now we calculate the same numbers in Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">eigvalsh</span>

<span class="c1"># Convenience functions and parameters:</span>
<span class="k">def</span> <span class="nf">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Kronecker delta function. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">k</span> <span class="k">else</span> <span class="mf">0.</span>

<span class="k">def</span> <span class="nf">f_approx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Padé approxmation to Fermi distribution. &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># kappa and epsilon are calculated further down</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="k">def</span> <span class="nf">kappa_epsilon</span><span class="p">(</span><span class="n">Nk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate kappa and epsilon coefficients. &quot;&quot;&quot;</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span><span class="p">):</span>
            <span class="n">alpha</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="n">eps</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha</span><span class="p">)[:</span><span class="n">Nk</span><span class="p">]]</span>

    <span class="n">alpha_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">alpha_p</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="n">chi</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">eigvalsh</span><span class="p">(</span><span class="n">alpha_p</span><span class="p">)[:</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>

    <span class="n">eta_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Nk</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">chi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span> <span class="o">/</span>
            <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span>
                <span class="n">eps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">eps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">deltafun</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>
            <span class="p">])</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">kappa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eta_list</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eps</span>

    <span class="k">return</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span>

<span class="n">kappa</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="n">kappa_epsilon</span><span class="p">(</span><span class="n">Nk</span><span class="p">)</span>

<span class="c1"># Phew, we made it to function that calculates the coefficients for the</span>
<span class="c1"># correlation function expansions:</span>

<span class="k">def</span> <span class="nf">C</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">Nk</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the expansion coefficients for C_\sigma. &quot;&quot;&quot;</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">T</span>
    <span class="n">ck</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">W</span> <span class="o">*</span> <span class="n">f_approx</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">W</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)]</span>
    <span class="n">vk</span> <span class="o">=</span> <span class="p">[</span><span class="n">W</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ck</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="o">-</span><span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">kappa</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">W</span><span class="o">**</span><span class="mi">2</span>
            <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">vk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epsilon</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="mf">1.0</span><span class="n">j</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ck</span><span class="p">,</span> <span class="n">vk</span>

<span class="n">ck_plus_L</span><span class="p">,</span> <span class="n">vk_plus_L</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mu_L</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>  <span class="c1"># C_+, left bath</span>
<span class="n">ck_minus_L</span><span class="p">,</span> <span class="n">vk_minus_L</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mu_L</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>  <span class="c1"># C_-, left bath</span>

<span class="n">ck_plus_R</span><span class="p">,</span> <span class="n">vk_plus_R</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mu_R</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>  <span class="c1"># C_+, right bath</span>
<span class="n">ck_minus_R</span><span class="p">,</span> <span class="n">vk_minus_R</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mu_R</span><span class="p">,</span> <span class="n">Nk</span><span class="p">)</span>  <span class="c1"># C_-, right bath</span>
</pre></div>
</div>
<p>Finally we are ready to construct the
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.FermionicBath" title="qutip.nonmarkov.heom.FermionicBath"><code class="xref py py-class docutils literal notranslate"><span class="pre">FermionicBath</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qutip.nonmarkov.heom</span> <span class="kn">import</span> <span class="n">FermionicBath</span>

<span class="c1"># Padé expansion:</span>
<span class="n">bath_L</span> <span class="o">=</span> <span class="n">FermionicBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">ck_plus_L</span><span class="p">,</span> <span class="n">vk_plus_L</span><span class="p">,</span> <span class="n">ck_minus_L</span><span class="p">,</span> <span class="n">vk_minus_L</span><span class="p">)</span>
<span class="n">bath_R</span> <span class="o">=</span> <span class="n">FermionicBath</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">ck_plus_R</span><span class="p">,</span> <span class="n">vk_plus_R</span><span class="p">,</span> <span class="n">ck_minus_R</span><span class="p">,</span> <span class="n">vk_minus_R</span><span class="p">)</span>
</pre></div>
</div>
<p>And we’re done!</p>
<p>The <a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.FermionicBath" title="qutip.nonmarkov.heom.FermionicBath"><code class="xref py py-class docutils literal notranslate"><span class="pre">FermionicBath</span></code></a> can be used with the
<a class="reference internal" href="../../apidoc/classes.html#qutip.nonmarkov.heom.HEOMSolver" title="qutip.nonmarkov.heom.HEOMSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">HEOMSolver</span></code></a> in exactly the same way as the baths
we constructed previously using the built-in Lorentzian bath expansions.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="history.html" class="btn btn-neutral float-right" title="Previous implementations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="bosonic.html" class="btn btn-neutral float-left" title="Bosonic Environments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; <a href="../../copyright.html">Copyright</a> 2011 to 2021 inclusive, QuTiP developers and contributors.
      <span class="lastupdated">
        Last updated on Jan 17, 2024.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>